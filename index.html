
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Relatório de Dívidas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <input type="month" id="monthFilter" />
    <button onclick="exportPDF()">Exportar PDF</button>
    <script>
        let recordedDebts = []; // simulado para demonstração
        
function exportPDF() {
    const selectedMonth = document.getElementById('monthFilter').value;
    if (!selectedMonth) {
        alert("Selecione um mês para exportar o relatório.");
        return;
    }
    const [year, month] = selectedMonth.split("-");
    const monthText = new Date(parseInt(year), parseInt(month) - 1).toLocaleString("pt-BR", { month: "long" });
    const filtered = recordedDebts.filter(debt => debt.dueDate.startsWith(selectedMonth));

    const grouped = filtered.reduce((acc, debt) => {
        acc[debt.company] = acc[debt.company] || [];
        acc[debt.company].push(debt);
        return acc;
    }, {});

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y = 15;

    doc.setFontSize(14);
    doc.text(`Relatório de Dívidas - ${monthText.toUpperCase()} ${year}`, 10, y);
    y += 10;

    const colors = [
        [221, 44, 0],   // vermelho
        [0, 123, 255],  // azul
        [40, 167, 69],  // verde
        [255, 193, 7],  // amarelo
        [108, 117, 125] // cinza
    ];

    let colorIndex = 0;

    Object.keys(grouped).forEach((company, i) => {
        const rows = grouped[company].map(debt => [
            debt.employee,
            "R$ " + debt.installmentValue.toFixed(2),
            monthText.charAt(0).toUpperCase() + monthText.slice(1),
            debt.description
        ]);

        const headerColor = colors[colorIndex % colors.length];
        colorIndex++;

        doc.autoTable({
            startY: y,
            head: [[`Empresa: ${company}`, '', '', '']],
            theme: 'plain',
            styles: { fontStyle: 'bold', fontSize: 12 },
            headStyles: { textColor: [0, 0, 0] },
        });

        doc.autoTable({
            startY: doc.lastAutoTable.finalY + 2,
            head: [["Funcionário", "Valor", "Mês", "Descrição"]],
            body: rows,
            theme: "striped",
            headStyles: {
                fillColor: headerColor,
                textColor: 255,
                fontStyle: 'bold'
            },
            styles: { fontSize: 10 },
        });

        y = doc.lastAutoTable.finalY + 10;
        if (y > 260) {
            doc.addPage();
            y = 15;
        }
    });

    doc.save(`Dividas-${monthText}-${year}.pdf`);
}

    </script>
</body>
</html>
